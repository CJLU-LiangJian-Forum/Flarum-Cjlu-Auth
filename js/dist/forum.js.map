{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://foskytech/cjlu-auth/webpack/bootstrap","webpack://foskytech/cjlu-auth/webpack/runtime/compat get default export","webpack://foskytech/cjlu-auth/webpack/runtime/define property getters","webpack://foskytech/cjlu-auth/webpack/runtime/hasOwnProperty shorthand","webpack://foskytech/cjlu-auth/webpack/runtime/make namespace object","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['common/app']\"","webpack://foskytech/cjlu-auth/./src/common/index.ts","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['extend']\"","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['common/extend']\"","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['forum/components/UserPage']\"","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['forum/app']\"","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://foskytech/cjlu-auth/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['components/Modal']\"","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['components/Button']\"","webpack://foskytech/cjlu-auth/./src/forum/components/LinkModal.js","webpack://foskytech/cjlu-auth/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['common/components/Button']\"","webpack://foskytech/cjlu-auth/./src/forum/components/Alert.js","webpack://foskytech/cjlu-auth/./src/forum/addAlert.js","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['app']\"","webpack://foskytech/cjlu-auth/external root \"flarum.core.compat['components/SettingsPage']\"","webpack://foskytech/cjlu-auth/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('foskytech/cjlu-auth', () => {\n\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/UserPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/listItems'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/Button'];","import Modal from 'flarum/components/Modal';\nimport Button from 'flarum/components/Button';\n\nexport default class LinkModal extends Modal {\n  className() {\n    return `CjluAuthLinkModal Modal--small`;\n  }\n\n  title() {\n    return app.translator.trans(`cjlu-auth.forum.modals.link.title`);\n  }\n\n  content() {\n    return (\n      <div className=\"Modal-body\">\n        <div className=\"Form Form--centered\">\n          <div className=\"Form-group\">\n            <input class=\"FormControl bottom\"\n                   className=\"user\"\n                   type=\"text\"\n                   placeholder={app.translator.trans(`cjlu-auth.forum.modals.link.user`)}\n                   oninput={e => this.user = e.target.value}\n                   disabled={this.inputDisabled}\n            >\n            </input>\n\n            <input class=\"FormControl bottom\"\n                   className=\"pass\"\n                   type=\"password\"\n                   placeholder={app.translator.trans(`cjlu-auth.forum.modals.link.pass`)}\n                   oninput={e => this.pass = e.target.value}\n                   disabled={this.inputDisabled}\n            >\n            </input>\n\n            <Button className={`Button Button--primary Button--block LogInButton--CjluAuth`} loading={this.loading} disabled={this.loading}\n                    onclick={() => this.submit(this.user, this.pass)} >\n              {app.translator.trans(`cjlu-auth.forum.buttons.submit`)}\n            </Button>\n          </div>\n\n          <a href=\"https://authserver.cjlu.edu.cn\" target=\"_blank\">统一认证</a>\n        </div>\n      </div>\n    );\n  }\n\n  submit(username, password) {\n    let t = typeof username;\n    let c = typeof password;\n    if (t != 'string' || c != 'string') return;\n\n    this.loading = true;\n    this.inputDisabled = true;\n\n    app\n      .request({\n        url: app.forum.attribute('apiUrl') + '/auth/cjlu/bind',\n        method: 'POST',\n        body: {\n          username: username,\n          password: password\n        },\n        errorHandler: this.onerror.bind(this),\n      }).catch((error) => {\n      this.inputDisabled = false;\n      app.alerts.show(\n        Alert,\n        {type: 'error'},\n        error\n      );\n    }).then((result) => {\n      this.loading = false;\n      this.inputDisabled = true;\n\n      if (!result.status) {\n        app.alerts.dismiss(alert);\n        switch (result.msg) {\n          case \"user_exist\":\n            this.inputDisabled = false;\n            app.alerts.show({type: 'error'}, app.translator.trans(`cjlu-auth.forum.alerts.user_exist`));\n            break;\n          case \"verify_failed\":\n            this.inputDisabled = false;\n            app.alerts.show({type: 'error'}, app.translator.trans(`cjlu-auth.forum.alerts.verify_failed`));\n            break;\n          default:\n            this.inputDisabled = false;\n            app.alerts.show({type: 'error'}, result.msg);\n            break;\n        }\n        return;\n      }\n      app.alerts.show({type: 'success'}, app.translator.trans(`cjlu-auth.forum.alerts.link_success`));\n      m.redraw();\n      window.location.reload();\n    });\n\n    /*const user = app.session.user;\n    user\n      .save({\n        username: username,\n        password: password\n      })\n      .catch((error) => {\n        app.alerts.show(\n          Alert,\n          {type: 'error'},\n          error\n        );\n      })\n      .then(() => {\n        this.hide();\n        app.alerts.show({type: 'success'}, app.translator.trans(`cjlu-auth.forum.alerts.link_success`));\n        m.redraw();\n        window.location.reload();\n      });*/\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import app from 'flarum/forum/app';\nimport listItems from 'flarum/common/helpers/listItems';\nimport LinkModal from './LinkModal';\nimport Button from 'flarum/common/components/Button';\nexport default class UpdateAlert {\n  HideAlert() {\n    const user = app.session.user;\n    if(!user){\n      return true;\n    }\n    return user.data.attributes.CjluAuth.isAuth;\n  }\n\n  view(){\n    if (this.HideAlert()) {\n      return m('div');\n    }\n\n    const controls = [\n      Button.component(\n        {\n          className: 'Button Button--link',\n          onclick: () => {\n            app.modal.show(LinkModal);\n          },\n        },\n        app.translator.trans('cjlu-auth.forum.alerts.toLink')\n      ),\n    ];\n    const dismissControl = [];\n    return m(\n      '.Alert.Alert-info',\n      m('.container', [\n        m(\n          'span.Alert-body', app.translator.trans(`cjlu-auth.forum.alerts.limit`)\n        ),\n        m('ul.Alert-controls',  listItems(controls.concat(dismissControl))),\n      ])\n    );\n  }\n\n}\n","import { override } from 'flarum/common/extend';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport Alert from './components/Alert';\n\n/* global m */\n\n// This single method will be used to inject the alert into existing components\n// If the view is already an array, we add our content at the start\n// If it isn't an array we wrap the content into a new array\nfunction addAlertToContent(original, ...originalArgs) {\n  const existing = original(...originalArgs);\n  const additional = m(Alert);\n\n  // if the existing content is an array, add to it\n  // This should only happen with the hero() override as other extensions might return an array there\n  if (Array.isArray(existing)) {\n    existing.unshift(additional);\n\n    return existing;\n  }\n\n  // Otherwise return a new list of elements\n  // Use a container div otherwise when extending view() this will prevent the config() method from running\n  // as the Component class won't be able to bind config() to an array\n  // We could also add to vnode.children but this could cause weird styling if another extension or custom styles\n  // change the look of the base page content by targeting the original view root element based on its class\n  // By using a new outer container we make sure the alert always stays full width and unaffected by the page view under it\n  return m('div', [additional, existing]);\n}\n\nexport default function () {\n  // There's no single place we can inject the banner\n  // So we use a few different points so it's visible on most pages\n  override(IndexPage.prototype, 'hero', addAlertToContent);\n  override(DiscussionPage.prototype, 'view', addAlertToContent);\n\n  // Covers user profile and settings\n  override(UserPage.prototype, 'view', addAlertToContent);\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/SettingsPage'];","import {extend} from 'flarum/extend';\nimport addAlert from './addAlert';\nimport app from 'flarum/app';\n\nexport * from './components/';\nimport SettingsPage from 'flarum/components/SettingsPage';\n\n/*import UnlinkModal from \"./components/UnlinkModal\";*/\nimport LinkModal from \"./components/LinkModal\";\n\nimport Button from 'flarum/components/Button';\n\napp.initializers.add('foskytech/cjlu-auth', () => {\n  addAlert();\n\n  extend(SettingsPage.prototype, 'accountItems', (items) => {\n    const {\n      data: {\n        attributes: {\n          CjluAuth: {\n            isAuth = false\n          },\n        },\n      },\n    } = app.session.user;\n\n    const user = app.session.user;\n    if (user.data.attributes.CjluAuth.isAuth) {\n      items.add(`linkCjluAuth`,\n        <Button className={`Button linkCjluAuthButton--danger`} icon=\"fas fa-id-badge\"\n                disabled=\"true\">\n          {app.translator.trans(`cjlu-auth.forum.buttons.has_bind`)}\n        </Button>\n      );\n    } else {\n\n      items.add(`linkCjluAuth`,\n        <Button className={`Button linkCjluAuthButton--success`} icon=\"fas fa-id-badge\"\n                onclick={() => app.modal.show(LinkModal)}>\n          {app.translator.trans(`cjlu-auth.forum.buttons.link`)}\n        </Button>\n      );\n    }\n\n\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","add","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","LinkModal","_Modal","subClass","superClass","apply","arguments","create","constructor","_proto","className","title","translator","trans","content","_this","m","class","type","placeholder","oninput","e","user","target","disabled","this","inputDisabled","pass","Button","loading","onclick","submit","href","username","password","_this2","request","url","forum","attribute","method","body","errorHandler","onerror","error","alerts","show","Alert","then","result","status","redraw","window","location","reload","dismiss","alert","msg","Modal","UpdateAlert","HideAlert","data","attributes","CjluAuth","isAuth","view","controls","listItems","concat","addAlertToContent","original","_len","length","originalArgs","Array","_key","existing","additional","isArray","unshift","override","IndexPage","DiscussionPage","UserPage","extend","SettingsPage","items","icon"],"sourceRoot":""}