(()=>{var t={n:r=>{var o=r&&r.__esModule?()=>r.default:()=>r;return t.d(o,{a:o}),o},d:(r,o)=>{for(var a in o)t.o(o,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:o[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r);const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("foskytech/cjlu-auth",(function(){}));const a=flarum.core.compat.extend,e=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/components/IndexPage"];var s=t.n(n);const u=flarum.core.compat["forum/components/DiscussionPage"];var l=t.n(u);const i=flarum.core.compat["forum/components/UserPage"];var c=t.n(i);const p=flarum.core.compat["forum/app"];var d=t.n(p);const f=flarum.core.compat["common/helpers/listItems"];var h=t.n(f);function b(t,r){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},b(t,r)}const y=flarum.core.compat["components/Modal"];var v=t.n(y);const j=flarum.core.compat["components/Button"];var g=t.n(j),A=function(t){var r,o;function a(){return t.apply(this,arguments)||this}o=t,(r=a).prototype=Object.create(o.prototype),r.prototype.constructor=r,b(r,o);var e=a.prototype;return e.className=function(){return"CjluAuthLinkModal Modal--small"},e.title=function(){return app.translator.trans("cjlu-auth.forum.modals.link.title")},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m("input",{class:"FormControl bottom",className:"user",type:"text",placeholder:app.translator.trans("cjlu-auth.forum.modals.link.user"),oninput:function(r){return t.user=r.target.value},disabled:this.inputDisabled}),m("input",{class:"FormControl bottom",className:"pass",type:"password",placeholder:app.translator.trans("cjlu-auth.forum.modals.link.pass"),oninput:function(r){return t.pass=r.target.value},disabled:this.inputDisabled}),m(g(),{className:"Button Button--primary Button--block LogInButton--CjluAuth",loading:this.loading,disabled:this.loading,onclick:function(){return t.submit(t.user,t.pass)}},app.translator.trans("cjlu-auth.forum.buttons.submit"))),m("a",{href:"https://authserver.cjlu.edu.cn",target:"_blank"},"统一认证")))},e.submit=function(t,r){var o=this;"string"==typeof t&&"string"==typeof r&&(this.loading=!0,this.inputDisabled=!0,app.request({url:app.forum.attribute("apiUrl")+"/auth/cjlu/bind",method:"POST",body:{username:t,password:r},errorHandler:this.onerror.bind(this)}).catch((function(t){o.inputDisabled=!1,app.alerts.show(Alert,{type:"error"},t)})).then((function(t){if(o.loading=!1,o.inputDisabled=!0,t.status)app.alerts.show({type:"success"},app.translator.trans("cjlu-auth.forum.alerts.link_success")),m.redraw(),window.location.reload();else switch(app.alerts.dismiss(alert),t.msg){case"user_exist":o.inputDisabled=!1,app.alerts.show({type:"error"},app.translator.trans("cjlu-auth.forum.alerts.user_exist"));break;case"verify_failed":o.inputDisabled=!1,app.alerts.show({type:"error"},app.translator.trans("cjlu-auth.forum.alerts.verify_failed"));break;default:o.inputDisabled=!1,app.alerts.show({type:"error"},t.msg)}})))},a}(v());const k=flarum.core.compat["common/components/Button"];var w=t.n(k),_=function(){function t(){}var r=t.prototype;return r.HideAlert=function(){var t=d().session.user;return!t||t.data.attributes.CjluAuth.isAuth},r.view=function(){if(this.HideAlert())return m("div");var t=[w().component({className:"Button Button--link",onclick:function(){d().modal.show(A)}},d().translator.trans("cjlu-auth.forum.alerts.toLink"))];return m(".Alert.Alert-info",m(".container",[m("span.Alert-body",d().translator.trans("cjlu-auth.forum.alerts.limit")),m("ul.Alert-controls",h()(t.concat([])))]))},t}();function B(t){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];var e=t.apply(void 0,o),n=m(_);return Array.isArray(e)?(e.unshift(n),e):m("div",[n,e])}const C=flarum.core.compat.app;var O=t.n(C);const P=flarum.core.compat["components/SettingsPage"];var N=t.n(P);O().initializers.add("foskytech/cjlu-auth",(function(){(0,e.override)(s().prototype,"hero",B),(0,e.override)(l().prototype,"view",B),(0,e.override)(c().prototype,"view",B),(0,a.extend)(N().prototype,"accountItems",(function(t){O().session.user.data.attributes.CjluAuth.isAuth,O().session.user.data.attributes.CjluAuth.isAuth?t.add("linkCjluAuth",m(g(),{className:"Button linkCjluAuthButton--danger",icon:"fas fa-id-badge",disabled:"true"},O().translator.trans("cjlu-auth.forum.buttons.has_bind"))):t.add("linkCjluAuth",m(g(),{className:"Button linkCjluAuthButton--success",icon:"fas fa-id-badge",onclick:function(){return O().modal.show(A)}},O().translator.trans("cjlu-auth.forum.buttons.link")))}))}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map